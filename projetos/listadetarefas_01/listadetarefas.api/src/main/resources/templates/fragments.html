<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<body>

<!-- FRAGMENTO: Lista de Tarefas -->
<th:block th:fragment="lista-tarefas(tarefas)">
    <th:block th:each="tarefa : ${tarefas}">
        <tr th:replace="~{fragments :: linha-tarefa(tarefa=${tarefa})}"></tr>
    </th:block>
</th:block>

<!-- FRAGMENTO: Linha da Tabela -->
<tr th:fragment="linha-tarefa(tarefa)" th:id="'tarefa-' + ${tarefa.id}">
    <!-- Célula do Checkbox -->
    <td th:classappend="${tarefa.concluida} ? 'concluida-texto' : ''">
        <input type="checkbox" th:checked="${tarefa.concluida}"
               th:hx-post="'/tarefas/' + ${tarefa.id} + '/toggle'"
               th:hx-target="'#tarefa-' + ${tarefa.id}"
               hx-swap="outerHTML">
    </td>
    <!-- Célula do Título -->
    <td th:text="${tarefa.titulo}" th:classappend="${tarefa.concluida} ? 'concluida-texto' : ''"></td>
    <!-- Célula da Descrição -->
    <td th:text="${tarefa.descricao}" th:classappend="${tarefa.concluida} ? 'concluida-texto' : ''"></td>
    <!-- Célula das Ações -->
    <td class="actions">
        <button class="btn-edit"
                th:hx-get="'/tarefas/' + ${tarefa.id} + '/edit'"
                th:hx-target="'#tarefa-' + ${tarefa.id}"
                hx-swap="outerHTML">Editar</button>
        <button class="btn-delete"
                th:hx-delete="'/tarefas/' + ${tarefa.id}"
                hx-target="closest tr"
                hx-swap="outerHTML"
                hx-confirm="Tem certeza que deseja apagar esta tarefa?">Deletar</button>
    </td>
</tr>

<!-- FRAGMENTO: Formulário de Edição -->
<tr th:fragment="edit-form(tarefa)" th:id="'tarefa-' + ${tarefa.id}">
    <td colspan="4">
        <form class="edit-form" th:hx-put="'/tarefas/' + ${tarefa.id}" th:hx-target="'#tarefa-' + ${tarefa.id}" hx-swap="outerHTML">
            <input type="text" name="titulo" th:value="${tarefa.titulo}" class="edit-input">
            <textarea name="descricao" th:text="${tarefa.descricao}" class="edit-input"></textarea>
            <button type="submit" class="btn-save">Salvar</button>
            <button type="button" class="btn-cancel" th:hx-get="'/tarefas/' + ${tarefa.id}" th:hx-target="'#tarefa-' + ${tarefa.id}">Cancelar</button>
        </form>
    </td>
</tr>

</body>
</html>
